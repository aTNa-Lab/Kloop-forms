(this["webpackJsonpkloop-forms"]=this["webpackJsonpkloop-forms"]||[]).push([[0],{123:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),l=n(11),o=n.n(l),s=(n(95),n(53)),c=n(54),i=n(60),u=n(59),m=(n(61),n(35)),d=n(9),p=n(13),f=n(48),h=n.n(f);h.a.initializeApp({apiKey:"AIzaSyDRhaklmVogc4wWVlf6MWMUS0gpMccfn0I",authDomain:"atna-lab.firebaseapp.com",databaseURL:"https://atna-lab.firebaseio.com",projectId:"atna-lab",storageBucket:"atna-lab.appspot.com",messagingSenderId:"436661740234",appId:"1:436661740234:web:8baf6f9f6c2c845d828a33",measurementId:"G-LF9JG7V3D4"});var w=new h.a.auth.GoogleAuthProvider,E=function(){h.a.auth().signInWithPopup(w)},b=h.a,v=n(36),g=r.a.createContext(),O=function(e){var t=e.children,n=Object(a.useState)(null),l=Object(p.a)(n,2),o=l[0],s=l[1],c=Object(a.useState)(!0),i=Object(p.a)(c,2),u=i[0],m=i[1];return Object(a.useEffect)((function(){b.auth().onAuthStateChanged((function(e){s(e),m(!1)}))}),[]),u?r.a.createElement(r.a.Fragment,null,"Loading..."):r.a.createElement(g.Provider,{value:{currentUser:o}},t)},j=n(153),k=n(164),y=Object(j.a)((function(e){return{root:{"& > *":{width:"40ch"}}}}));var A=function(e){var t=y(),n=r.a.useState(""),l=Object(p.a)(n,2),o=l[0],s=l[1],c=e.index,i=e.response;return Object(a.useEffect)((function(){i&&s(i)}),[i]),r.a.createElement("div",null,r.a.createElement("form",{noValidate:!0,autoComplete:"off"},r.a.createElement("h4",null,e.title),r.a.createElement(k.a,{className:t.root,id:"inputBox"+c,label:"\u041c\u043e\u0439 \u043e\u0442\u0432\u0435\u0442",value:o,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,c,t.target.value)},disabled:!!e.locked})))},x=n(165),S=n(166),C=n(159),R=n(160),U=Object(j.a)((function(e){return{formControl:{minWidth:120}}}));function N(e){var t=U(),n=r.a.useState(""),l=Object(p.a)(n,2),o=l[0],s=l[1],c=r.a.useState(!1),i=Object(p.a)(c,2),u=i[0],m=i[1],d=e.index,f=e.response;Object(a.useEffect)((function(){f&&s(f)}),[f]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(C.a,{className:t.formControl,disabled:!!e.locked},r.a.createElement(x.a,{id:"controlled-open-select-label"},"\u0412\u044b\u0431\u0440\u0430\u0442\u044c"),r.a.createElement(R.a,{labelId:"controlled-open-select-label",id:"select"+d,open:u,onClose:function(e){m(!1)},onOpen:function(e){m(!0)},value:o,onChange:function(t){s(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,d,n)}},r.a.createElement(S.a,{value:""},r.a.createElement("em",null,"None")),e.answers.map((function(e,t){return r.a.createElement(S.a,{key:t,value:e},e)})))))}var D=n(161),q=n(163),F=n(167);function I(e){var t=r.a.useState(""),n=Object(p.a)(t,2),l=n[0],o=n[1],s=e.index,c=e.response;Object(a.useEffect)((function(){c&&o(c)}),[c]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement(C.a,{const:"fieldset"},r.a.createElement(q.a,{"aria-label":e.title,name:e.title,value:l,onChange:function(t){o(t.target.value);var n=e.answers.indexOf(t.target.value);e.returnAnswer(t.target.value,s,n)}},e.answers.map((function(t,n){return r.a.createElement(F.a,{key:n,value:t,control:r.a.createElement(D.a,null),label:t,disabled:!!e.locked})})))))}var K=Object(j.a)((function(e){return{container:{display:"flex",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"auto"}}}));function M(e){var t=K(),n=r.a.useState(""),l=Object(p.a)(n,2),o=l[0],s=l[1],c=e.index,i=e.response;Object(a.useEffect)((function(){i&&s(i)}),[c,i]);return r.a.createElement("div",null,r.a.createElement("h4",null,e.title),r.a.createElement("form",{className:t.container,noValidate:!0},r.a.createElement(k.a,{id:"time"+c,label:"\u0412\u0440\u0435\u043c\u044f",type:"time",value:o,onChange:function(t){s(t.target.value),e.returnAnswer(t.target.value,c,t.target.value)},className:t.textField,InputLabelProps:{shrink:!0},InputProps:{disableUnderline:!0},disabled:!!e.locked})))}function P(e){var t=Object(a.useState)({}),n=Object(p.a)(t,2),l=n[0],o=n[1],s=Object(a.useState)({}),c=Object(p.a)(s,2),i=c[0],u=c[1],m={},d={},f=e.index,h=e.response;Object(a.useEffect)((function(){h&&o(h)}),[h]);var w=function(t){return function(n){(m=Object(v.a)({},l))[t]=n.target.value,o(m),d=Object(v.a)({},i);var a=e.answers.indexOf(n.target.value);d[t]=a,u(d),e.returnAnswer(m,f,d)}};return r.a.createElement("div",{className:"radioHorizontal"},r.a.createElement("h4",null,e.title),r.a.createElement("button",{onClick:function(){o({}),e.returnAnswer({},f)}},"clear"),r.a.createElement("div",{className:"question_item"},e.subquestion.map((function(t,n){return r.a.createElement("div",{className:"question_item_",key:n},r.a.createElement("p",null,t),r.a.createElement(C.a,{component:"fieldset"},r.a.createElement(q.a,{"aria-label":"position",name:"position",row:!0,value:l[n]?l[n]:"",onClick:w(n)},e.answers.map((function(t,a){return r.a.createElement(F.a,{key:a,value:t,control:r.a.createElement(D.a,{color:"primary"}),label:n>0?"":t,labelPlacement:"top",disabled:!!e.locked,style:{paddingLeft:5,paddingRight:5}})})))))}))))}var _=n(71),L=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return(e=t.call.apply(t,[this].concat(r))).state={questions:[],main_title:"",gateway:"",answers:{},shortAnswers:{},showAnswers:!1,response:{},period:null,locked:!1,files:{},showFileUpload:!1},e.downloadData=function(){var t=_.parse(window.location.search,{decode:!1});e.props.url?fetch(e.props.url).then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(n){console.log("DATA",n),e.setState({questions:n.questions,main_title:n.main_title,gateway:n.gateway,period:n.period}),t.response&&e.initResponse(n,t),n.period&&e.timeManager(n)})):console.log("ERROR: no url detected")},e.uploadData=function(){try{var t=b.database().ref().child("RE:Message").child(e.context.currentUser.uid);t.child("Username").set(e.context.currentUser.displayName),t.child("Email").set(e.context.currentUser.email),t.child(e.state.main_title).child("Answers").push(e.state.answers),console.log("data uploaded"),e.setState({showFileUpload:!0}),e.setState({showAnswers:!0})}catch(n){alert(n),e.setState({showAnswers:!0})}},e.uploadFiles=function(t,n){var a=b.storage().ref().child("Forms_files").child(e.context.currentUser.uid).child(e.state.main_title).child(n),r=t.target.files;console.log(r),Array.from(r).forEach((function(t){a.child(t.name).put(t).then((function(t){return console.log("SNAPSHOT",t),b.database().ref().child("RE:Message").child(e.context.currentUser.uid).child(e.state.main_title).child("Filepaths").push(t.metadata.fullPath),t.ref.getDownloadURL()})).then((function(e){console.log(e)})).catch(console.error)}))},e.timeManager=function(t){var n=new Date,a=new Date(t.period.start),r=new Date(t.period.finish);console.log(n,a,r),a>n&&t.period.before.nofill||a<n&&n<r&&t.period.in.nofill||n>r&&t.period.after.nofill?e.setState({locked:!0}):e.setState({locked:!1}),console.log("LOCKED ",e.state.locked)},e.initResponse=function(t,n){var a=decodeURI(n.response),r=JSON.parse(a);console.log(r),e.setState({response:r});for(var l=0,o=Object.entries(r);l<o.length;l++){var s=Object(p.a)(o[l],2),c=s[0],i=s[1],u=null;if(c===Object.keys(r)[0]&&e.returnAnswer(i,c),"input"===t.questions[c].type)e.returnAnswer(i,c);else if("time"===t.questions[c].type)e.returnAnswer(i,c,i);else if("multiradio"===t.questions[c].type)for(var m=0,d=Object.entries(i);m<d.length;m++){var f=Object(p.a)(d[m],2),h=f[0],w=f[1],E=t.questions[c].answer.indexOf(w),b=Object(v.a)({},e.state.shortAnswers[c]);b[h]=E,e.returnAnswer(i,c,b)}else u=t.questions[c].answer.indexOf(i),e.returnAnswer(i,c,u)}},e.returnAnswer=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=Object(v.a)({},e.state.answers);r[n]=t,e.setState({answers:r});var l=Object(v.a)({},e.state.shortAnswers);l[n]=a,e.setState({shortAnswers:l})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.downloadData()}},{key:"render",value:function(){var e=this,t=this.state.questions.map((function(t,n){var a=e.state.response,l=!1;return t.attachMaterials&&(l=!0),"input"===t.type?r.a.createElement(A,{key:n,index:n,title:t.title,response:a[n],attachment:l,returnAnswer:e.returnAnswer,locked:e.state.locked}):"select"===t.type?r.a.createElement(N,{key:n,index:n,title:t.title,response:a[n],attachment:l,answers:t.answer,returnAnswer:e.returnAnswer,locked:e.state.locked}):"radio"===t.type?r.a.createElement(I,{key:n,index:n,title:t.title,response:a[n],attachment:l,answers:t.answer,returnAnswer:e.returnAnswer,locked:e.state.locked}):"time"===t.type?r.a.createElement(M,{key:n,index:n,title:t.title,response:a[n],attachment:l,returnAnswer:e.returnAnswer,locked:e.state.locked}):"multiradio"===t.type?r.a.createElement(P,{key:n,index:n,title:t.title,response:a[n],attachment:l,subquestion:t.subquestion,answers:t.answer,returnAnswer:e.returnAnswer,locked:e.state.locked}):null}));return r.a.createElement("div",null,r.a.createElement("h1",{className:"text-align-center"},this.state.main_title),this.state.showAnswers?r.a.createElement("p",{style:{textAlign:"left"}},"Full answers: ",JSON.stringify(this.state.answers)):null,this.state.showAnswers?r.a.createElement("p",{style:{textAlign:"left"}},"Short answers: ",JSON.stringify(this.state.shortAnswers)):null,this.state.showFileUpload?this.state.questions.map((function(t,n){return r.a.createElement("div",{key:n},t.attachMaterials?r.a.createElement("div",null,r.a.createElement("h5",null,t.title),r.a.createElement("input",{type:"file",name:"filefield",multiple:"multiple",onChange:function(t){return e.uploadFiles(t,n.toString())}})):null)})):r.a.createElement("div",null,t,r.a.createElement("div",{style:{paddingTop:20,paddingBottom:20,textAlign:"center"}},r.a.createElement("button",{disabled:!!this.state.locked,onClick:this.uploadData},"Send data"))))}}]),n}(a.Component);L.contextType=g;var W=L,J=n(71),B=function(){var e=Object(a.useState)([]),t=Object(p.a)(e,2),n=t[0],l=t[1];return Object(a.useEffect)((function(){var e=J.parse(window.location.search);console.log(e),e.url?fetch(e.url).then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(e){console.log("DATA",e),l(e)})):console.log("ERROR: no url detected")}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Home"),r.a.createElement("button",{onClick:function(){return b.auth().signOut()}},"Sign out"),r.a.createElement(m.a,null,r.a.createElement("div",null,r.a.createElement("nav",null,r.a.createElement("ul",null,n.map((function(e,t){return r.a.createElement("li",{key:t},r.a.createElement(m.b,{to:"/Kloop-forms"+e.path+window.location.search},e.label))})))),r.a.createElement(d.d,null,n.map((function(e,t){return r.a.createElement(d.b,{key:t,path:"/Kloop-forms"+e.path},(function(){return r.a.createElement(W,{url:e.url+window.location.search})}))}))))))},G=Object(d.g)((function(e){e.history;return Object(a.useContext)(g).currentUser?r.a.createElement(d.a,{to:"/Kloop-forms"+window.location.search}):r.a.createElement("div",null,r.a.createElement("h1",null,"Log in"),r.a.createElement("button",{onClick:E},"Sign-in with Google"))})),T=n(65),V=n.n(T),H=n(75),z=Object(d.g)((function(e){var t=e.history;Object(a.useCallback)(function(){var e=Object(H.a)(V.a.mark((function e(n){var a,r,l;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=n.target.elements,r=a.email,l=a.password,e.prev=2,e.next=5,b.auth().createUserWithEmailAndPassword(r.value,l.value);case 5:t.push("/Kloop-forms"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),alert(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),[t]);return r.a.createElement("div",null,r.a.createElement("h1",null,"Sign up"),r.a.createElement("button",{onClick:E},"Sign-in with Google"))})),$=n(76),Q=function(e){var t=e.component,n=Object($.a)(e,["component"]),l=Object(a.useContext)(g).currentUser;return r.a.createElement(d.b,Object.assign({},n,{render:function(e){return l?r.a.createElement(t,e):r.a.createElement(d.a,{to:"/Kloop-forms/login"+window.location.search})}}))},X=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(O,null,r.a.createElement(m.a,null,r.a.createElement("div",null,r.a.createElement("nav",null,r.a.createElement("li",null,r.a.createElement(m.b,{to:"/Kloop-forms"+window.location.search},"Home"))),r.a.createElement(Q,{exact:!0,path:"/Kloop-forms",component:B}),r.a.createElement(d.b,{exact:!0,path:"/Kloop-forms/login",component:G}),r.a.createElement(d.b,{exact:!0,path:"/Kloop-forms/signup",component:z})))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},61:function(e,t,n){},90:function(e,t,n){e.exports=n(123)},95:function(e,t,n){}},[[90,1,2]]]);
//# sourceMappingURL=main.84b214a6.chunk.js.map